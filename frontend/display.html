<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Lists</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
</head>

<body>

    <h1 id="greeting">Hello, <span id="username"></span></h1>

    <!-- Button to open the modal for adding a new list -->
    <button id="openAddListModal" class="btn btn-primary">Add New List</button>

    <!-- Table for displaying lists -->
    <table id="listsTable">
        <thead>
            <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- List content will be added here via JavaScript -->
        </tbody>
    </table>

    <!-- Modal for adding a new list -->
    <div id="addListModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeAddModal">&times;</span>
            <h2>Add New List</h2>
            <input type="text" id="listTitle" placeholder="List Title" required>
            <textarea id="listDescription" placeholder="List Description" required></textarea>
            <button id="submitList" class="btn btn-success">Add List</button>
        </div>
    </div>

    <!-- Modal for editing an existing list -->
    <div id="editListModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeEditModal">&times;</span>
            <h2>Edit List</h2>
            <input type="text" id="editListTitle" placeholder="New Title" required>
            <textarea id="editListDescription" placeholder="New Description" required></textarea>
            <input type="text" id="sharedUser" placeholder="Share with user (email)" required>
            <button id="submitEditList" class="btn btn-success">Save Changes</button>
        </div>
    </div>

    <script>
        const SERVER = 'http://127.0.0.1:8000/listitem/';

        // Load username from localStorage and set in greeting
        const username = localStorage.getItem('username') || 'Guest';
        document.getElementById('username').innerText = username;




        // Display data function
        const displayData = (lists) => {
            const tbody = document.querySelector('#listsTable tbody');
            tbody.innerHTML = ''; // Clear previous content

            // Show only active lists
            lists.filter(list => list.is_active).forEach(function (list) {
                var tr = document.createElement('tr');
                tr.setAttribute('data-list-id', list.id);  // Set ID as attribute
                tr.innerHTML = `
            <td>${list.title}</td>
            <td>${list.description}</td>
            <td>
                <button class="btn btn-warning" onclick="openEditModal(${list.id}, '${list.title}', '${list.description}')">Edit</button>
                <button class="btn btn-danger" onclick="markListAsInactive(${list.id})">Mark as Inactive</button>
            </td>
        `;
                tbody.appendChild(tr);
            });
        };


        








        // Load lists when the page opens
        window.onload = fetchLists();

    </script>
</body>

</html>